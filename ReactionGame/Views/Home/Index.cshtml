@{
    ViewBag.Title = "Reaktionstisspelet";
}

<h2>Du är nu med i Reaktionstidsspelet :)</h2>
<div>
    <input type="hidden" id="playerName" />
    <ul id="listOfPlayers"></ul>
    <br />
    <p id="message"></p>
    <div id="clickTarget" style="width:200px;height:200px;text-align: center;vertical-align: middle;line-height: 200px;font-size:20px;font-weight:bold;cursor:pointer;" onclick="targetClicked()">

    </div>
</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            var $connection = $.connection;
            var $gameHub = $connection.reactionGameHub;

            $gameHub.client.updateListOfPlayers = function (players) { updateListOfPlayers(players, $gameHub.connection.id); };
            $gameHub.client.updateGameStatus = function (status) { updateGameStatus(status); };
            $gameHub.client.showFastestClicker = function (player) { showFastestClicker(player, $gameHub.connection.id); };

            // Get the user name and store it to prepend to messages.
            $('#playerName').val(prompt('Enter your name:', ''));
            // Start the connection.
            $connection.hub.start().done(function () {
                $gameHub.server.join($('#playerName').val());
            });
        });

        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }

        function updateListOfPlayers(players, connectionId) {
            var $listOfPlayers = $('#listOfPlayers');
            $listOfPlayers.empty();
            $.each(players, function (index, player) {
                var playerInfo = htmlEncode(player.Name) + ': ' + player.Points;
                playerInfo = player.Id == connectionId ? '<b>' + playerInfo + '</b>' : playerInfo;
                $listOfPlayers.append('<li>' + playerInfo + '</li>');
            });
        }

        function updateGameStatus(status){
            var color;
            var text;
            switch (status) {
                case "GetReady":
                    color = '#ffff00';
                    text = 'Var beredd!';
                    break;
                case "Go":
                    color = '#00ff00';
                    text = 'KLICKA!!!';
                    break;
                case "Stop":
                    color = '#ff0000';
                    text = 'Stopp!';
                    break;
                default:
                    color = '#000000';
                    break;
            }
            var $clicktarget = $('#clickTarget');
            $clicktarget.css('background-color', color);
            $clicktarget.text(text);
        }

        function showFastestClicker(player, connectionId) {
            var fastest = player.Id == connectionId ? 'DU!!!' : player.Name;
            $('#message').text('Snabbast var ' + fastest).fadeIn(500).fadeOut(3000);
        }

        function targetClicked() {
            $.connection.reactionGameHub.server.targetClicked();
        }
    </script>
}